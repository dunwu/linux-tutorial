(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{444:function(t,a,s){"use strict";s.r(a);var e=s(15),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"gitlab-运维"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-运维"}},[t._v("#")]),t._v(" Gitlab 运维")]),t._v(" "),s("h2",{attrs:{id:"一、gitlab-安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、gitlab-安装"}},[t._v("#")]),t._v(" 一、gitlab 安装")]),t._v(" "),s("h3",{attrs:{id:"gitlab-的普通安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-的普通安装"}},[t._v("#")]),t._v(" Gitlab 的普通安装")]),t._v(" "),s("h4",{attrs:{id:"下载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载"}},[t._v("#")]),t._v(" 下载")]),t._v(" "),s("p",[t._v("进入官方下载地址：https://about.gitlab.com/install/ ，如下图，选择合适的版本。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/dev/snap/20190129155838.png",alt:"img"}})]),t._v(" "),s("p",[t._v("以 CentOS7 为例：")]),t._v(" "),s("h4",{attrs:{id:"安装和配置必要依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装和配置必要依赖"}},[t._v("#")]),t._v(" 安装和配置必要依赖")]),t._v(" "),s("p",[t._v("在系统防火墙中启用 HTTP 和 SSH")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sudo yum install -y curl policycoreutils-python openssh-server\nsudo systemctl enable sshd\nsudo systemctl start sshd\nsudo firewall-cmd --permanent --add-service=http\nsudo systemctl reload firewalld\n")])])]),s("p",[t._v("安装 Postfix ，使得 Gitlab 可以发送通知邮件")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sudo yum install postfix\nsudo systemctl enable postfix\nsudo systemctl start postfix\n")])])]),s("h4",{attrs:{id:"添加-gitlab-yum-仓库并安装包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加-gitlab-yum-仓库并安装包"}},[t._v("#")]),t._v(" 添加 Gitlab yum 仓库并安装包")]),t._v(" "),s("p",[t._v("添加 Gitlab yum 仓库")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash\n")])])]),s("p",[t._v("通过 yum 安装 gitlab-ce")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('sudo EXTERNAL_URL="http://gitlab.example.com" yum install -y gitlab-ce\n')])])]),s("p",[t._v("安装完成后，即可通过默认的 root 账户进行登录。更多细节可以参考："),s("a",{attrs:{href:"https://docs.gitlab.com/omnibus/README.html#installation-and-configuration-using-omnibus-package",target:"_blank",rel:"noopener noreferrer"}},[t._v("documentation for detailed instructions on installing and configuration"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"gitlab-的-docker-安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-的-docker-安装"}},[t._v("#")]),t._v(" Gitlab 的 Docker 安装")]),t._v(" "),s("p",[t._v("拉取镜像")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker pull docker.io/gitlab/gitlab-ce\n")])])]),s("p",[t._v("启动")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker run -d \\\n    --hostname gitlab.zp.io \\\n    --publish 8443:443 --publish 80:80 --publish 2222:22 \\\n    --name gitlab \\\n    --restart always \\\n    --volume $GITLAB_HOME/config:/etc/gitlab \\\n    --volume $GITLAB_HOME/logs:/var/log/gitlab \\\n    --volume $GITLAB_HOME/data:/var/opt/gitlab \\\n    gitlab/gitlab-ce\n")])])]),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/dev/snap/20190131150515.png",alt:"img"}})]),t._v(" "),s("h3",{attrs:{id:"自签名证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自签名证书"}},[t._v("#")]),t._v(" 自签名证书")]),t._v(" "),s("p",[t._v("首先，创建认证目录")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sudo mkdir -p /etc/gitlab/ssl\nsudo chmod 700 /etc/gitlab/ssl\n")])])]),s("p",[t._v("（1）创建 Private Key")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sudo openssl genrsa -des3 -out /etc/gitlab/ssl/gitlab.domain.com.key 2048\n")])])]),s("p",[t._v("会提示输入密码，请记住")]),t._v(" "),s("p",[t._v("（2）生成 Certificate Request")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sudo openssl req -new -key /etc/gitlab/ssl/gitlab.domain.com.key -out /etc/gitlab/ssl/gitlab.domain.com.csr\n")])])]),s("p",[t._v("根据提示，输入信息")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Country Name (2 letter code) [XX]:CN\nState or Province Name (full name) []:JS\nLocality Name (eg, city) [Default City]:NJ\nOrganization Name (eg, company) [Default Company Ltd]:xxxxx\nOrganizational Unit Name (eg, section) []:\nCommon Name (eg, your name or your server's hostname) []:gitlab.xxxx.io\nEmail Address []:\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:\n")])])]),s("p",[t._v("（3）移除 Private Key 中的密码短语")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sudo cp -v /etc/gitlab/ssl/gitlab.domain.com.{key,original}\nsudo openssl rsa -in /etc/gitlab/ssl/gitlab.domain.com.original -out /etc/gitlab/ssl/gitlab.domain.com.key\nsudo rm -v /etc/gitlab/ssl/gitlab.domain.com.original\n")])])]),s("p",[t._v("（4）设置文件权限")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sudo chmod 600 /etc/gitlab/ssl/gitlab.domain.com.*\n")])])]),s("h2",{attrs:{id:"二、gitlab-ci-multi-runner-安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、gitlab-ci-multi-runner-安装"}},[t._v("#")]),t._v(" 二、gitlab-ci-multi-runner 安装")]),t._v(" "),s("blockquote",[s("p",[t._v("参考：https://docs.gitlab.com/runner/install/")])]),t._v(" "),s("h3",{attrs:{id:"常规安装-gitlab-ci-multi-runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常规安装-gitlab-ci-multi-runner"}},[t._v("#")]),t._v(" 常规安装 gitlab-ci-multi-runner")]),t._v(" "),s("h4",{attrs:{id:"下载-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载-2"}},[t._v("#")]),t._v(" 下载")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sudo wget -O /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64\n")])])]),s("h4",{attrs:{id:"配置执行权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置执行权限"}},[t._v("#")]),t._v(" 配置执行权限")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sudo chmod +x /usr/local/bin/gitlab-runner\n")])])]),s("h4",{attrs:{id:"如果想使用-docker-安装-docker-可选的"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如果想使用-docker-安装-docker-可选的"}},[t._v("#")]),t._v(" 如果想使用 Docker，安装 Docker（可选的）")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("curl -sSL https://get.docker.com/ | sh\n")])])]),s("h4",{attrs:{id:"创建-ci-用户"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建-ci-用户"}},[t._v("#")]),t._v(" 创建 CI 用户")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sudo useradd --comment 'GitLab Runner' --create-home gitlab-runner --shell /bin/bash\n")])])]),s("h4",{attrs:{id:"安装并启动服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装并启动服务"}},[t._v("#")]),t._v(" 安装并启动服务")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sudo gitlab-runner install --user=gitlab-runner --working-directory=/home/gitlab-runner\nsudo gitlab-runner start\n")])])]),s("h4",{attrs:{id:"注册-runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注册-runner"}},[t._v("#")]),t._v(" 注册 Runner")]),t._v(" "),s("p",[t._v("（1）执行命令：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sudo gitlab-runner register\n")])])]),s("p",[t._v("（2）输入 Gitlab URL 和 令牌")]),t._v(" "),s("p",[t._v("URL 和令牌信息在 Gitlab 的 Runner 管理页面获取：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/dev/snap/20190129163100.png",alt:"img"}})]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com )\nhttps://gitlab.com\n\nPlease enter the gitlab-ci token for this runner\nxxx\n")])])]),s("p",[t._v("（3）输入 Runner 的描述")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(" Please enter the gitlab-ci description for this runner\n [hostame] my-runner\n")])])]),s("p",[t._v("（4）输入 Runner 相关的标签")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(" Please enter the gitlab-ci tags for this runner (comma separated):\n my-tag,another-tag\n")])])]),s("p",[t._v("（5）输入 Runner 执行器")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(" Please enter the executor: ssh, docker+machine, docker-ssh+machine, kubernetes, docker, parallels, virtualbox, docker-ssh, shell:\n docker\n")])])]),s("p",[t._v("如果想选择 Docker 作为执行器，你需要指定默认镜像（ "),s("code",[t._v(".gitlab-ci.yml")]),t._v(" 中没有此配置）")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(" Please enter the Docker image (eg. ruby:2.1):\n alpine:latest\n")])])]),s("h3",{attrs:{id:"docker-安装-gitlab-ci-multi-runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-安装-gitlab-ci-multi-runner"}},[t._v("#")]),t._v(" Docker 安装 gitlab-ci-multi-runner")]),t._v(" "),s("p",[t._v("拉取镜像")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker pull docker.io/gitlab/gitlab-runner\n")])])]),s("p",[t._v("启动")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker run -d --name gitlab-runner --restart always \\\n   -v /srv/gitlab-runner/config:/etc/gitlab-runner \\\n   -v /var/run/docker.sock:/var/run/docker.sock \\\n   gitlab/gitlab-runner:latest\n")])])]),s("h2",{attrs:{id:"三、gitlab-配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、gitlab-配置"}},[t._v("#")]),t._v(" 三、gitlab 配置")]),t._v(" "),s("h3",{attrs:{id:"基本配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基本配置"}},[t._v("#")]),t._v(" 基本配置")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sudo vim /etc/gitlab/gitlab.rb\nexternal_url 'https://gitlab.domain.com'\n")])])]),s("h4",{attrs:{id:"gitlab-网站-https"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-网站-https"}},[t._v("#")]),t._v(" gitlab 网站 https：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("nginx['redirect_http_to_https'] = true\n")])])]),s("h4",{attrs:{id:"gitlab-ci-网站-https"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ci-网站-https"}},[t._v("#")]),t._v(" gitlab ci 网站 https：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("ci_nginx['redirect_http_to_https'] = true\n")])])]),s("h4",{attrs:{id:"复制证书到-gitlab-目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#复制证书到-gitlab-目录"}},[t._v("#")]),t._v(" 复制证书到 gitlab 目录：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sudo cp /etc/gitlab/ssl/gitlab.domain.com.crt /etc/gitlab/trusted-certs/\n")])])]),s("h4",{attrs:{id:"gitlab-重新配置-更新"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-重新配置-更新"}},[t._v("#")]),t._v(" gitlab 重新配置+更新：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sudo gitlab-ctl reconfigure\nsudo gitlab-ctl restart\n")])])]),s("h3",{attrs:{id:"创建你的-ssh-key"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建你的-ssh-key"}},[t._v("#")]),t._v(" 创建你的 SSH key")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("使用 Gitlab 的第一步是生成你自己的 SSH 密钥对（Github 也类似）。")])]),t._v(" "),s("li",[s("p",[t._v("登录 Gitlab")])]),t._v(" "),s("li",[s("p",[t._v("打开 "),s("strong",[t._v("Profile settings")]),t._v(".")])])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://docs.gitlab.com/ce/gitlab-basics/img/profile_settings.png",alt:"img"}})]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("跳转到 "),s("strong",[t._v("SSH keys")]),t._v(" tab 页")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://docs.gitlab.com/ce/gitlab-basics/img/profile_settings_ssh_keys.png",alt:"img"}})]),t._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[t._v("黏贴你的 SSH 公钥内容到 Key 文本框")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://docs.gitlab.com/ce/gitlab-basics/img/profile_settings_ssh_keys_paste_pub.png",alt:"img"}})]),t._v(" "),s("ol",{attrs:{start:"6"}},[s("li",[t._v("为了便于识别，你可以为其命名")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://docs.gitlab.com/ce/gitlab-basics/img/profile_settings_ssh_keys_title.png",alt:"img"}})]),t._v(" "),s("ol",{attrs:{start:"7"}},[s("li",[t._v("点击 "),s("strong",[t._v("Add key")]),t._v(" 将 SSH 公钥添加到 GitLab")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://docs.gitlab.com/ce/gitlab-basics/img/profile_settings_ssh_keys_single_key.png",alt:"img"}})]),t._v(" "),s("h3",{attrs:{id:"创建项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建项目"}},[t._v("#")]),t._v(" 创建项目")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/dev/snap/20190131150658.png",alt:"img"}})]),t._v(" "),s("p",[t._v("输入项目信息，点击 Create project 按钮，在 Gitlab 创建项目。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/dunwu/images/dev/snap/20190131150759.png",alt:"img"}})]),t._v(" "),s("h3",{attrs:{id:"克隆项目到本地"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#克隆项目到本地"}},[t._v("#")]),t._v(" 克隆项目到本地")]),t._v(" "),s("p",[t._v("可以选择 SSH 或 HTTPS 方式克隆项目到本地（推荐 SSH）")]),t._v(" "),s("p",[t._v("拷贝项目地址，然后在本地执行 "),s("code",[t._v("git clone <url>")])]),t._v(" "),s("h3",{attrs:{id:"创建-issue"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建-issue"}},[t._v("#")]),t._v(" 创建 Issue")]),t._v(" "),s("p",[t._v("依次点击 "),s("strong",[t._v("Project’s Dashboard")]),t._v(" > "),s("strong",[t._v("Issues")]),t._v(" > "),s("strong",[t._v("New Issue")]),t._v(" 可以新建 Issue")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://docs.gitlab.com/ce/user/project/issues/img/new_issue_from_tracker_list.png",alt:"img"}})]),t._v(" "),s("p",[t._v("在项目中直接添加 issue")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://docs.gitlab.com/ce/user/project/issues/img/new_issue.png",alt:"img"}})]),t._v(" "),s("p",[t._v("在未关闭 issue 中，点击 "),s("strong",[t._v("New Issue")]),t._v(" 添加 issue")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://docs.gitlab.com/ce/user/project/issues/img/new_issue_from_open_issue.png",alt:"img"}})]),t._v(" "),s("p",[t._v("通过项目面板添加 issue")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://docs.gitlab.com/ce/user/project/issues/img/new_issue_from_projects_dashboard.png",alt:"img"}})]),t._v(" "),s("p",[t._v("通过 issue 面板添加 issue")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://docs.gitlab.com/ce/user/project/issues/img/new_issue_from_issue_board.png",alt:"img"}})]),t._v(" "),s("h2",{attrs:{id:"四、gitlab-权限配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、gitlab-权限配置"}},[t._v("#")]),t._v(" 四、gitlab 权限配置")]),t._v(" "),s("h3",{attrs:{id:"用户组的权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#用户组的权限"}},[t._v("#")]),t._v(" 用户组的权限")]),t._v(" "),s("ul",[s("li",[t._v("用户组有这几种权限的概念："),s("code",[t._v("Guest、Reporter、Developer、Master、Owner")])]),t._v(" "),s("li",[t._v("这个概念在设置用户组的时候会遇到，叫做："),s("code",[t._v("Add user(s) to the group")]),t._v("，比如链接："),s("code",[t._v("https://<gitlab_host>/<group>")])])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("行为")]),t._v(" "),s("th",[t._v("Guest")]),t._v(" "),s("th",[t._v("Reporter")]),t._v(" "),s("th",[t._v("Developer")]),t._v(" "),s("th",[t._v("Master")]),t._v(" "),s("th",[t._v("Owner")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("浏览组")]),t._v(" "),s("td",[t._v("✓")]),t._v(" "),s("td",[t._v("✓")]),t._v(" "),s("td",[t._v("✓")]),t._v(" "),s("td",[t._v("✓")]),t._v(" "),s("td",[t._v("✓")])]),t._v(" "),s("tr",[s("td",[t._v("编辑组")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("✓")])]),t._v(" "),s("tr",[s("td",[t._v("创建项目")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("✓")]),t._v(" "),s("td",[t._v("✓")])]),t._v(" "),s("tr",[s("td",[t._v("管理组成员")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td",[t._v("✓")])]),t._v(" "),s("tr",[s("td",[t._v("移除组")]),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td"),t._v(" "),s("td")])])]),t._v(" "),s("h2",{attrs:{id:"五、备份-迁移-升级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、备份-迁移-升级"}},[t._v("#")]),t._v(" 五、备份/迁移/升级")]),t._v(" "),s("h3",{attrs:{id:"备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#备份"}},[t._v("#")]),t._v(" 备份")]),t._v(" "),s("h4",{attrs:{id:"手动备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#手动备份"}},[t._v("#")]),t._v(" 手动备份")]),t._v(" "),s("p",[t._v("执行 "),s("code",[t._v("gitlab-rake gitlab:backup:create")]),t._v(" 开始备份全量数据，成功后，会在 "),s("code",[t._v("/var/opt/gitlab/backups")]),t._v(" 下生产一个名称类似 "),s("code",[t._v("1585910556_2020_04_03_11.3.0_gitlab_backup.tar")]),t._v(" 的压缩包。")]),t._v(" "),s("h3",{attrs:{id:"定时自动备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#定时自动备份"}},[t._v("#")]),t._v(" 定时自动备份")]),t._v(" "),s("p",[t._v("可以利用 crontab 来定时执行备份命令。")]),t._v(" "),s("p",[t._v("执行 "),s("code",[t._v("vim /etc/crontab")]),t._v(" 或 "),s("code",[t._v("crontab -e")]),t._v(" 手动编辑定时任务。")]),t._v(" "),s("h3",{attrs:{id:"迁移"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#迁移"}},[t._v("#")]),t._v(" 迁移")]),t._v(" "),s("blockquote",[s("p",[t._v("迁移前，需要确保新老机器的 Gitlab 版本号一致。")])]),t._v(" "),s("p",[t._v("将备份的压缩包拷贝到新机器的备份路径下（默认为 "),s("code",[t._v("/var/opt/gitlab/backups")]),t._v("）。")]),t._v(" "),s("p",[t._v("（1）将备份文件权限修改为 777，不然可能恢复的时候会出现权限不够，不能解压的问题")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("777")]),t._v(" 1585910556_2020_04_03_11.3.0_gitlab_backup.tar\n")])])]),s("p",[t._v("（2）停止相关数据连接服务")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("gitlab-ctl stop unicorn\ngitlab-ctl stop sidekiq\n")])])]),s("p",[t._v("（3）从备份文件中恢复 Gitlab")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gitlab-rake gitlab:backup:restore BACKUP=备份文件编号")]),t._v("\ngitlab-rake gitlab:backup:restore "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("BACKUP")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("1585910556_2020_04_03_11.3.0\n")])])]),s("h3",{attrs:{id:"升级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#升级"}},[t._v("#")]),t._v(" 升级")]),t._v(" "),s("p",[t._v("升级前，一定要做好备份，记录当前 gitlab 的版本号。")]),t._v(" "),s("p",[t._v("第一步还是使用官方命令进行升级。")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y gitlab-ce\n")])])]),s("p",[t._v("如果下载速度理想，就无需手动升级安装。不理想就需要"),s("code",[t._v("停止自动更新")]),t._v("，并手动下载安装包")]),t._v(" "),s("p",[t._v("访问官方地址，下载对应"),s("code",[t._v("版本")]),t._v("，对应"),s("code",[t._v("系统")]),t._v("的安装包。")]),t._v(" "),s("p",[t._v("注：可以根据"),s("code",[t._v("自动升级时下载的版本")]),t._v("，选择对应文件。")]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("https:")]),t._v("//packages.gitlab.com/gitlab/gitlab-ce\n")])])]),s("p",[t._v("安装包手动上传至服务器，并"),s("code",[t._v("替换")]),t._v("下载未完成的安装包。下面是升级缓存地址：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("/var/cache/yum/x86_64/7/gitlab_gitlab-ce/packages/\n")])])]),s("p",[t._v("再次执行官方升级命令即可完成自动安装。")]),t._v(" "),s("h2",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),s("ul",[s("li",[t._v("官网：https://about.gitlab.com/")]),t._v(" "),s("li",[t._v("中文网：https://www.gitlab.com.cn/")]),t._v(" "),s("li",[t._v("官网下载：https://about.gitlab.com/downloads/")]),t._v(" "),s("li",[t._v("官网安装说明：https://about.gitlab.com/installation/#centos-7")]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/dunwu/OS",target:"_blank",rel:"noopener noreferrer"}},[t._v("操作系统、运维部署总结系列"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);