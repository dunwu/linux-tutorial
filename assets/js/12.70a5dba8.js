(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{400:function(e,r,t){"use strict";t.r(r);var a=t(15),n=Object(a.a)({},(function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"docker-cheat-sheet"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-cheat-sheet"}},[e._v("#")]),e._v(" Docker Cheat Sheet")]),e._v(" "),t("blockquote",[t("p",[e._v("内容主要搬迁自："),t("a",{attrs:{href:"https://github.com/wsargent/docker-cheat-sheet/tree/master/zh-cn",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Cheat Sheet"),t("OutboundLink")],1)])]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#%E4%B8%BA%E4%BD%95%E4%BD%BF%E7%94%A8-docker"}},[e._v("为何使用 Docker")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#%E8%BF%90%E7%BB%B4"}},[e._v("运维")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#%E5%AE%B9%E5%99%A8container"}},[e._v("容器(Container)")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#%E9%95%9C%E5%83%8Fimages"}},[e._v("镜像(Images)")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#%E7%BD%91%E7%BB%9Cnetworks"}},[e._v("网络(Networks)")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#%E4%BB%93%E7%AE%A1%E4%B8%AD%E5%BF%83%E5%92%8C%E4%BB%93%E5%BA%93registry--repository"}},[e._v("仓管中心和仓库(Registry & Repository)")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#dockerfile"}},[e._v("Dockerfile")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#%E5%B1%82layers"}},[e._v("层(Layers)")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#%E9%93%BE%E6%8E%A5links"}},[e._v("链接(Links)")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#%E5%8D%B7%E6%A0%87volumes"}},[e._v("卷标(Volumes)")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#%E6%9A%B4%E9%9C%B2%E7%AB%AF%E5%8F%A3exposing-ports"}},[e._v("暴露端口(Exposing ports)")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"}},[e._v("最佳实践")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#%E5%AE%89%E5%85%A8security"}},[e._v("安全(Security)")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#%E5%B0%8F%E8%B4%B4%E5%A3%AB"}},[e._v("小贴士")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"}},[e._v("参考资料")])])]),e._v(" "),t("h2",{attrs:{id:"为何使用-docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为何使用-docker"}},[e._v("#")]),e._v(" 为何使用 Docker")]),e._v(" "),t("p",[e._v("「通过 Docker，开发者可以使用任何语言任何工具创建任何应用。“Dockerized” 的应用是完全可移植的，能在任何地方运行 - 不管是同事的 OS X 和 Windows 笔记本，或是在云端运行的 Ubuntu QA 服务，还是在虚拟机运行的 Red Hat 产品数据中心。")]),e._v(" "),t("p",[e._v("Docker Hub 上有 13000+ 的应用，开发者可以从中选取一个进行快速扩展开发。Docker 跟踪管理变更和依赖关系，让系统管理员能更容易理解开发人员是如何让应用运转起来的。而开发者可以通过 Docker Hub 的共有/私有仓库，构建他们的自动化编译，与其他合作者共享成果。")]),e._v(" "),t("p",[e._v("Docker 帮助开发者更快地构建和发布高质量的应用。」—— "),t("a",{attrs:{href:"https://www.docker.com/what-docker/#copy1",target:"_blank",rel:"noopener noreferrer"}},[e._v("什么是 Docker"),t("OutboundLink")],1)]),e._v(" "),t("h2",{attrs:{id:"运维"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运维"}},[e._v("#")]),e._v(" 运维")]),e._v(" "),t("h3",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[e._v("#")]),e._v(" 安装")]),e._v(" "),t("p",[e._v("Docker 是一个开源的商业产品，有两个版本：社区版（Community Edition，缩写为 CE）和企业版（Enterprise Edition，缩写为 EE）。企业版包含了一些收费服务，个人开发者一般用不到。")]),e._v(" "),t("p",[e._v("Docker CE 的安装请参考官方文档。")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/docker-for-mac/install/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Mac"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/docker-for-windows/install/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Windows"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/install/linux/docker-ce/ubuntu/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Ubuntu"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/install/linux/docker-ce/debian/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Debian"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/install/linux/docker-ce/centos/",target:"_blank",rel:"noopener noreferrer"}},[e._v("CentOS"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/install/linux/docker-ce/fedora/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Fedora"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/install/linux/docker-ce/binaries/",target:"_blank",rel:"noopener noreferrer"}},[e._v("其他 Linux 发行版"),t("OutboundLink")],1)])]),e._v(" "),t("h3",{attrs:{id:"检查版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查版本"}},[e._v("#")]),e._v(" 检查版本")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/version/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker version")]),t("OutboundLink")],1),e._v(" 查看你正在运行的 Docker 版本。")]),e._v(" "),t("p",[e._v("获取 Docker 服务版本：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker version --format '{{.Server.Version}}'\n")])])]),t("p",[e._v("你也可以输出原始的 JSON 数据：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker version --format '{{json .}}'\n")])])]),t("h3",{attrs:{id:"docker-加速"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-加速"}},[e._v("#")]),e._v(" Docker 加速")]),e._v(" "),t("p",[e._v("国内访问 Docker Hub 很慢，所以，推荐配置 Docker 镜像仓库来提速。")]),e._v(" "),t("p",[e._v("镜像仓库清单：")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("镜像仓库")]),e._v(" "),t("th",[e._v("镜像仓库地址")]),e._v(" "),t("th",[e._v("说明")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[t("a",{attrs:{href:"https://daocloud.io/mirror",target:"_blank",rel:"noopener noreferrer"}},[e._v("DaoCloud 镜像站"),t("OutboundLink")],1)]),e._v(" "),t("td",[t("code",[e._v("http://f1361db2.m.daocloud.io")])]),e._v(" "),t("td",[e._v("开发者需要开通 DaoCloud 账户，然后可以得到专属加速器。")])]),e._v(" "),t("tr",[t("td",[t("a",{attrs:{href:"https://cr.console.aliyun.com",target:"_blank",rel:"noopener noreferrer"}},[e._v("阿里云"),t("OutboundLink")],1)]),e._v(" "),t("td",[t("code",[e._v("https://yourcode.mirror.aliyuncs.com")])]),e._v(" "),t("td",[e._v("开发者需要开通阿里开发者帐户，再使用阿里的加速服务。登录后阿里开发者帐户后，"),t("code",[e._v("https://cr.console.aliyun.com/undefined/instances/mirrors")]),e._v(" 中查看你的您的专属加速器地址。")])]),e._v(" "),t("tr",[t("td",[t("a",{attrs:{href:"https://c.163yun.com/hub",target:"_blank",rel:"noopener noreferrer"}},[e._v("网易云"),t("OutboundLink")],1)]),e._v(" "),t("td",[t("code",[e._v("https://hub-mirror.c.163.com")])]),e._v(" "),t("td",[e._v("直接配置即可，亲测较为稳定。")])])])]),e._v(" "),t("p",[e._v("配置镜像仓库方法（以 CentOS 为例）：")]),e._v(" "),t("blockquote",[t("p",[e._v("下面的示例为在 CentOS 环境中，指定镜像仓库为 "),t("code",[e._v("https://hub-mirror.c.163.com")])])]),e._v(" "),t("p",[e._v("（1）修改配置文件")]),e._v(" "),t("p",[e._v("修改 "),t("code",[e._v("/etc/docker/daemon.json")]),e._v(" ，如果不存在则新建。执行以下 Shell：")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" -p /etc/docker\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">>")]),e._v(" /etc/docker/daemon.json "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('EOF\n{\n    "registry-mirrors": [\n        "https://hub-mirror.c.163.com"\n    ]\n}\nEOF')]),e._v("\n")])])]),t("p",[e._v("重启 docker 以生效：")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" systemctl daemon-reload\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" systemctl restart docker\n")])])]),t("p",[e._v("执行 "),t("code",[e._v("docker info")]),e._v(" 命令，查看 "),t("code",[e._v("Registry Mirrors")]),e._v(" 是否已被改为 "),t("code",[e._v("https://hub-mirror.c.163.com")]),e._v(" ，如果是，则表示配置成功。")]),e._v(" "),t("h2",{attrs:{id:"容器-container"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#容器-container"}},[e._v("#")]),e._v(" 容器(Container)")]),e._v(" "),t("p",[t("a",{attrs:{href:"http://etherealmind.com/basics-docker-containers-hypervisors-coreos/",target:"_blank",rel:"noopener noreferrer"}},[e._v("关于 Docker 进程隔离的基础"),t("OutboundLink")],1),e._v("。容器 (Container) 之于虚拟机 (Virtual Machine) 就好比线程之于进程。或者你可以把他们想成是「吃了类固醇的 chroots」。")]),e._v(" "),t("h3",{attrs:{id:"生命周期"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生命周期"}},[e._v("#")]),e._v(" 生命周期")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/create",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker create")]),t("OutboundLink")],1),e._v(" 创建容器但不启动它。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/rename/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker rename")]),t("OutboundLink")],1),e._v(" 用于重命名容器。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/run",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker run")]),t("OutboundLink")],1),e._v(" 一键创建并同时启动该容器。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/rm",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker rm")]),t("OutboundLink")],1),e._v(" 删除容器。\n"),t("ul",[t("li",[e._v("如果要删除一个运行中的容器，可以添加 "),t("code",[e._v("-f")]),e._v(" 参数。Docker 会发送 "),t("code",[e._v("SIGKILL")]),e._v(" 信号给容器。")])])]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/update/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker update")]),t("OutboundLink")],1),e._v(" 调整容器的资源限制。")]),e._v(" "),t("li",[e._v("清理掉所有处于终止状态的容器。")])]),e._v(" "),t("p",[e._v("通常情况下，不使用任何命令行选项启动一个容器，该容器将会立即启动并停止。若需保持其运行，你可以使用 "),t("code",[e._v("docker run -td container_id")]),e._v(" 命令。选项 "),t("code",[e._v("-t")]),e._v(" 表示分配一个 pseudo-TTY 会话，"),t("code",[e._v("-d")]),e._v(" 表示自动将容器与终端分离（也就是说在后台运行容器，并输出容器 ID）。")]),e._v(" "),t("p",[e._v("如果你需要一个临时容器，可使用 "),t("code",[e._v("docker run --rm")]),e._v(" 会在容器停止之后删除它。")]),e._v(" "),t("p",[e._v("如果你需要映射宿主机 (host) 的目录到 Docker 容器内，可使用 "),t("code",[e._v("docker run -v $HOSTDIR:$DOCKERDIR")]),e._v("。详见 "),t("a",{attrs:{href:"https://github.com/wsargent/docker-cheat-sheet/tree/master/zh-cn#%E5%8D%B7%E6%A0%87volumes",target:"_blank",rel:"noopener noreferrer"}},[e._v("卷标(Volumes)"),t("OutboundLink")],1),e._v(" 一节。")]),e._v(" "),t("p",[e._v("如果你想同时删除与容器相关联的卷标，那么在删除容器的时候必须包含 "),t("code",[e._v("-v")]),e._v(" 选项，像这样 "),t("code",[e._v("docker rm -v")]),e._v("。")]),e._v(" "),t("p",[e._v("从 Docker 1.10 起，其内置一套各容器独立的 "),t("a",{attrs:{href:"https://docs.docker.com/engine/admin/logging/overview/",target:"_blank",rel:"noopener noreferrer"}},[e._v("日志引擎"),t("OutboundLink")],1),e._v("，每个容器可以独立使用。你可以使用 "),t("code",[e._v("docker run --log-driver=syslog")]),e._v(" 来自定义日志引擎（例如以上的 "),t("code",[e._v("syslog")]),e._v("）。")]),e._v(" "),t("h3",{attrs:{id:"启动和停止"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动和停止"}},[e._v("#")]),e._v(" 启动和停止")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/start",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker start")]),t("OutboundLink")],1),e._v(" 启动已存在的容器。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stop",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker stop")]),t("OutboundLink")],1),e._v(" 停止运行中的容器。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/restart",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker restart")]),t("OutboundLink")],1),e._v(" 重启容器。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/pause/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker pause")]),t("OutboundLink")],1),e._v(" 暂停运行中的容器，将其「冻结」在当前状态。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/unpause/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker unpause")]),t("OutboundLink")],1),e._v(" 结束容器暂停状态。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/wait",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker wait")]),t("OutboundLink")],1),e._v(" 阻塞地等待某个运行中的容器直到停止。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/kill",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker kill")]),t("OutboundLink")],1),e._v(" 向运行中的容器发送 SIGKILL 指令。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/attach",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker attach")]),t("OutboundLink")],1),e._v(" 连接到运行中的容器。")])]),e._v(" "),t("p",[e._v("如果你想将容器的端口 (ports) 暴露至宿主机，请见 "),t("a",{attrs:{href:"https://github.com/wsargent/docker-cheat-sheet/tree/master/zh-cn#%E6%9A%B4%E9%9C%B2%E7%AB%AF%E5%8F%A3exposing-ports",target:"_blank",rel:"noopener noreferrer"}},[e._v("暴露端口"),t("OutboundLink")],1),e._v(" 一节。")]),e._v(" "),t("p",[e._v("关于 Docker 实例崩溃后的重启策略，详见 "),t("a",{attrs:{href:"http://container42.com/2014/09/30/docker-restart-policies/",target:"_blank",rel:"noopener noreferrer"}},[e._v("本文"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("h4",{attrs:{id:"cpu-限制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cpu-限制"}},[e._v("#")]),e._v(" CPU 限制")]),e._v(" "),t("p",[e._v("你可以限制 CPU 资源占用，无论是指定百分比，或是特定核心数。")]),e._v(" "),t("p",[e._v("例如，你可以设置 "),t("a",{attrs:{href:"https://docs.docker.com/engine/reference/run/#/cpu-share-constraint",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("cpu-shares")]),t("OutboundLink")],1),e._v("。该配置看起来有点奇怪 -- 1024 表示 100% CPU，因此如果你希望容器使用所有 CPU 内核的 50%，应将其设置为 512：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker run -ti --c 512 agileek/cpuset-test\n")])])]),t("p",[e._v("更多信息请参阅 https://goldmann.pl/blog/2014/09/11/resource-management-in-docker/#_cpu。")]),e._v(" "),t("p",[e._v("通过 "),t("a",{attrs:{href:"https://docs.docker.com/engine/reference/run/#/cpuset-constraint",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("cpuset-cpus")]),t("OutboundLink")],1),e._v(" 可使用特定 CPU 内核。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker run -ti --cpuset-cpus=0,4,6 agileek/cpuset-test\n")])])]),t("p",[e._v("请参阅 https://agileek.github.io/docker/2014/08/06/docker-cpuset/ 获取更多细节以及一些不错的视频。")]),e._v(" "),t("p",[e._v("注意，Docker 在容器内仍然能够 "),t("strong",[e._v("看到")]),e._v(" 全部 CPU -- 它仅仅是不使用全部而已。请参阅 https://github.com/docker/docker/issues/20770 获取更多细节。")]),e._v(" "),t("h4",{attrs:{id:"内存限制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内存限制"}},[e._v("#")]),e._v(" 内存限制")]),e._v(" "),t("p",[e._v("同样，亦可给 Docker 设置 "),t("a",{attrs:{href:"https://docs.docker.com/engine/reference/run/#/user-memory-constraints",target:"_blank",rel:"noopener noreferrer"}},[e._v("内存限制"),t("OutboundLink")],1),e._v("：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker run -it -m 300M ubuntu:14.04 /bin/bash\n")])])]),t("h4",{attrs:{id:"能力-capabilities"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#能力-capabilities"}},[e._v("#")]),e._v(" 能力(Capabilities)")]),e._v(" "),t("p",[e._v("Linux 的 Capability 可以通过使用 "),t("code",[e._v("cap-add")]),e._v(" 和 "),t("code",[e._v("cap-drop")]),e._v(" 设置。请参阅 https://docs.docker.com/engine/reference/run/#/runtime-privilege-and-linux-capabilities 获取更多细节。这有助于提高安全性。")]),e._v(" "),t("p",[e._v("如需要挂载基于 FUSE 的文件系统，你需要结合 "),t("code",[e._v("--cap-add")]),e._v(" 和 "),t("code",[e._v("--device")]),e._v(" 使用：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker run --rm -it --cap-add SYS_ADMIN --device /dev/fuse sshfs\n")])])]),t("p",[e._v("授予对某个设备的访问权限：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker run -it --device=/dev/ttyUSB0 debian bash\n")])])]),t("p",[e._v("授予对所有设备的访问权限：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker run -it --privileged -v /dev/bus/usb:/dev/bus/usb debian bash\n")])])]),t("p",[e._v("有关容器特权的更多信息请参阅 "),t("a",{attrs:{href:"https://docs.docker.com/engine/reference/run/#/runtime-privilege-and-linux-capabilities",target:"_blank",rel:"noopener noreferrer"}},[e._v("本文"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("h3",{attrs:{id:"信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#信息"}},[e._v("#")]),e._v(" 信息")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/ps",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker ps")]),t("OutboundLink")],1),e._v(" 查看运行中的所有容器。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/logs",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker logs")]),t("OutboundLink")],1),e._v(" 从容器中读取日志。（你也可以使用自定义日志驱动，不过在 1.10 中，它只支持 "),t("code",[e._v("json-file")]),e._v(" 和 "),t("code",[e._v("journald")]),e._v("）。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/inspect",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker inspect")]),t("OutboundLink")],1),e._v(" 查看某个容器的所有信息（包括 IP 地址）。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/events",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker events")]),t("OutboundLink")],1),e._v(" 从容器中获取事件 (events)。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/port",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker port")]),t("OutboundLink")],1),e._v(" 查看容器的公开端口。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/top",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker top")]),t("OutboundLink")],1),e._v(" 查看容器中活动进程。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stats",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker stats")]),t("OutboundLink")],1),e._v(" 查看容器的资源使用量统计信息。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/diff",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker diff")]),t("OutboundLink")],1),e._v(" 查看容器文件系统中存在改动的文件。")])]),e._v(" "),t("p",[t("code",[e._v("docker ps -a")]),e._v(" 将显示所有容器，包括运行中和已停止的。")]),e._v(" "),t("p",[t("code",[e._v("docker stats --all")]),e._v(" 同样将显示所有容器，默认仅显示运行中的容器。")]),e._v(" "),t("h3",{attrs:{id:"导入-导出"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#导入-导出"}},[e._v("#")]),e._v(" 导入 / 导出")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/cp",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker cp")]),t("OutboundLink")],1),e._v(" 在容器和本地文件系统之间复制文件或目录。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/export",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker export")]),t("OutboundLink")],1),e._v(" 将容器的文件系统打包为归档文件流 (tarball archive stream) 并输出至标准输出 (STDOUT)。")])]),e._v(" "),t("h3",{attrs:{id:"执行命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行命令"}},[e._v("#")]),e._v(" 执行命令")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/exec",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker exec")]),t("OutboundLink")],1),e._v(" 在容器内执行命令。")])]),e._v(" "),t("p",[e._v("例如，进入正在运行的 "),t("code",[e._v("foo")]),e._v(" 容器，并连接 (attach) 到一个新的 Shell 进程："),t("code",[e._v("docker exec -it foo /bin/bash")]),e._v("。")]),e._v(" "),t("h2",{attrs:{id:"镜像-images"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#镜像-images"}},[e._v("#")]),e._v(" 镜像(Images)")]),e._v(" "),t("p",[e._v("镜像是 "),t("a",{attrs:{href:"https://docs.docker.com/engine/understanding-docker/#how-does-a-docker-image-work",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker 容器的模板"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("h3",{attrs:{id:"生命周期-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生命周期-2"}},[e._v("#")]),e._v(" 生命周期")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/images",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker images")]),t("OutboundLink")],1),e._v(" 查看所有镜像。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/import",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker import")]),t("OutboundLink")],1),e._v(" 从归档文件创建镜像。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/build",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker build")]),t("OutboundLink")],1),e._v(" 从 Dockerfile 创建镜像。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/commit",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker commit")]),t("OutboundLink")],1),e._v(" 为容器创建镜像，如果容器正在运行则会临时暂停。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/rmi",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker rmi")]),t("OutboundLink")],1),e._v(" 删除镜像。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/load",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker load")]),t("OutboundLink")],1),e._v(" 从标准输入 (STDIN) 加载归档包 (tar archive) 作为镜像，包括镜像本身和标签 (tags, 0.7 起)。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/save",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker save")]),t("OutboundLink")],1),e._v(" 将镜像打包为归档包，并输出至标准输出 (STDOUT)，包括所有的父层、标签和版本 (parent layers, tags, versions, 0.7 起)。")])]),e._v(" "),t("h3",{attrs:{id:"其它信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其它信息"}},[e._v("#")]),e._v(" 其它信息")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/history",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker history")]),t("OutboundLink")],1),e._v(" 查看镜像的历史记录。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/tag",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker tag")]),t("OutboundLink")],1),e._v(" 给镜像打标签命名（本地或者仓库均可）。")])]),e._v(" "),t("h3",{attrs:{id:"清理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#清理"}},[e._v("#")]),e._v(" 清理")]),e._v(" "),t("p",[e._v("虽然你可以用 "),t("code",[e._v("docker rmi")]),e._v(" 命令来删除指定的镜像，不过有个名为 "),t("a",{attrs:{href:"https://github.com/spotify/docker-gc",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker-gc"),t("OutboundLink")],1),e._v(" 的工具，它可以以一种安全的方式，清理掉那些不再被任何容器使用的镜像。Docker 1.13 起，使用 "),t("code",[e._v("docker image prune")]),e._v(" 亦可删除未使用的镜像。参见 "),t("a",{attrs:{href:"https://github.com/wsargent/docker-cheat-sheet/tree/master/zh-cn#%E6%B8%85%E7%90%86",target:"_blank",rel:"noopener noreferrer"}},[e._v("清理"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("h3",{attrs:{id:"加载-保存镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#加载-保存镜像"}},[e._v("#")]),e._v(" 加载 / 保存镜像")]),e._v(" "),t("p",[e._v("从文件中加载镜像：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker load < my_image.tar.gz\n")])])]),t("p",[e._v("保存既有镜像：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker save my_image:my_tag | gzip > my_image.tar.gz\n")])])]),t("h3",{attrs:{id:"导入-导出容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#导入-导出容器"}},[e._v("#")]),e._v(" 导入 / 导出容器")]),e._v(" "),t("p",[e._v("从文件中导入容器镜像：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("cat my_container.tar.gz | docker import - my_image:my_tag\n")])])]),t("p",[e._v("导出既有容器：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker export my_container | gzip > my_container.tar.gz\n")])])]),t("h3",{attrs:{id:"加载已保存的镜像-与-导入已导出为镜像的容器-的不同"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#加载已保存的镜像-与-导入已导出为镜像的容器-的不同"}},[e._v("#")]),e._v(" 加载已保存的镜像 与 导入已导出为镜像的容器 的不同")]),e._v(" "),t("p",[e._v("通过 "),t("code",[e._v("load")]),e._v(" 命令来加载镜像，会创建一个新的镜像，并继承原镜像的所有历史。 通过 "),t("code",[e._v("import")]),e._v(" 将容器作为镜像导入，也会创建一个新的镜像，但并不包含原镜像的历史，因此会比使用 "),t("code",[e._v("load")]),e._v(" 方式生成的镜像更小。")]),e._v(" "),t("h2",{attrs:{id:"网络-networks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#网络-networks"}},[e._v("#")]),e._v(" 网络(Networks)")]),e._v(" "),t("p",[e._v("Docker 具备 "),t("a",{attrs:{href:"https://docs.docker.com/engine/userguide/networking/",target:"_blank",rel:"noopener noreferrer"}},[e._v("网络"),t("OutboundLink")],1),e._v(" 功能。我并不是很了解它，所以这是一个扩展本文的好地方。文档 "),t("a",{attrs:{href:"https://docs.docker.com/engine/userguide/networking/work-with-networks/",target:"_blank",rel:"noopener noreferrer"}},[e._v("使用网络"),t("OutboundLink")],1),e._v(" 指出，这是一种无需暴露端口即可实现 Docker 容器间通信的好方法。")]),e._v(" "),t("h3",{attrs:{id:"生命周期-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生命周期-3"}},[e._v("#")]),e._v(" 生命周期")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_create/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker network create")]),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_rm/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker network rm")]),t("OutboundLink")],1)])]),e._v(" "),t("h3",{attrs:{id:"其它信息-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其它信息-2"}},[e._v("#")]),e._v(" 其它信息")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_ls/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker network ls")]),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_inspect/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker network inspect")]),t("OutboundLink")],1)])]),e._v(" "),t("h3",{attrs:{id:"建立连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#建立连接"}},[e._v("#")]),e._v(" 建立连接")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_connect/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker network connect")]),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_disconnect/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker network disconnect")]),t("OutboundLink")],1)])]),e._v(" "),t("p",[e._v("你可以 "),t("a",{attrs:{href:"https://blog.jessfraz.com/post/ips-for-all-the-things/",target:"_blank",rel:"noopener noreferrer"}},[e._v("为容器指定 IP 地址"),t("OutboundLink")],1),e._v("：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("# 使用你自己的子网和网关创建一个桥接网络\ndocker network create --subnet 203.0.113.0/24 --gateway 203.0.113.254 iptastic\n\n# 基于以上创建的网络，运行一个 Nginx 容器并指定 IP\n$ docker run --rm -it --net iptastic --ip 203.0.113.2 nginx\n\n# 在其他地方使用 CURL 访问这个 IP（假设该 IP 为公网）\n$ curl 203.0.113.2\n")])])]),t("h2",{attrs:{id:"暴露端口-exposing-ports"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#暴露端口-exposing-ports"}},[e._v("#")]),e._v(" 暴露端口(Exposing ports)")]),e._v(" "),t("p",[e._v("通过宿主容器暴露输入端口相当 "),t("a",{attrs:{href:"https://docs.docker.com/engine/reference/run/#expose-incoming-ports",target:"_blank",rel:"noopener noreferrer"}},[e._v("繁琐但有效的"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("p",[e._v("例如使用 "),t("code",[e._v("-p")]),e._v(" 将容器端口映射到宿主端口上（只使用本地主机 (localhost) 接口）：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker run -p 127.0.0.1:$HOSTPORT:$CONTAINERPORT --name CONTAINER -t someimage\n")])])]),t("p",[e._v("你可以使用 "),t("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#expose",target:"_blank",rel:"noopener noreferrer"}},[e._v("EXPOSE"),t("OutboundLink")],1),e._v(" 告知 Docker，该容器在运行时监听指定的端口：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("EXPOSE <CONTAINERPORT>\n")])])]),t("p",[e._v("但是注意 EXPOSE 并不会直接暴露端口，你需要用参数 "),t("code",[e._v("-p")]),e._v(" 。比如说你要在 localhost 上暴露容器的端口:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("iptables -t nat -A DOCKER -p tcp --dport <LOCALHOSTPORT> -j DNAT --to-destination <CONTAINERIP>:<PORT>\n")])])]),t("p",[e._v("如果你是在 Virtualbox 中运行 Docker，那么你需要配置端口转发 (forward the port)。使用 "),t("a",{attrs:{href:"https://docs.vagrantup.com/v2/networking/forwarded_ports.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("forwarded_port"),t("OutboundLink")],1),e._v(" 在 Vagrantfile 上配置暴露的端口范围，这样你就可以动态地映射了：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|\n  ...\n\n  (49000..49900).each do |port|\n    config.vm.network :forwarded_port, :host => port, :guest => port\n  end\n\n  ...\nend\n")])])]),t("p",[e._v("如果你忘记了将什么端口映射到宿主机上的话，可使用 "),t("code",[e._v("docker port")]),e._v(" 查看：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker port CONTAINER $CONTAINERPORT\n")])])]),t("h2",{attrs:{id:"仓管中心和仓库-registry-repository"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#仓管中心和仓库-registry-repository"}},[e._v("#")]),e._v(" 仓管中心和仓库(Registry & Repository)")]),e._v(" "),t("p",[e._v("仓库 (repository) 是 "),t("em",[e._v("被托管(hosted)")]),e._v(" 的已命名镜像 (tagged images) 的集合，这组镜像用于构建容器文件系统。")]),e._v(" "),t("p",[e._v("仓管中心 (registry) 则是 "),t("em",[e._v("托管服务(host)")]),e._v(" -- 用于存储仓库并提供 HTTP API，以便 "),t("a",{attrs:{href:"https://docs.docker.com/engine/tutorials/dockerrepos/",target:"_blank",rel:"noopener noreferrer"}},[e._v("管理仓库的上传和下载"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("p",[e._v("Docker 官方托管着自己的 "),t("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("仓管中心"),t("OutboundLink")],1),e._v("，包含着数量众多的仓库。不过话虽如此，这个仓管中心 "),t("a",{attrs:{href:"https://titanous.com/posts/docker-insecurity",target:"_blank",rel:"noopener noreferrer"}},[e._v("并没有很好地验证镜像"),t("OutboundLink")],1),e._v("，所以如果你担心安全问题的话，请尽量避免使用它。")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/login",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker login")]),t("OutboundLink")],1),e._v(" 登入仓管中心。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/logout",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker logout")]),t("OutboundLink")],1),e._v(" 登出仓管中心。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/search",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker search")]),t("OutboundLink")],1),e._v(" 从仓管中心检索镜像。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/pull",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker pull")]),t("OutboundLink")],1),e._v(" 从仓管中心拉取镜像到本地。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/push",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker push")]),t("OutboundLink")],1),e._v(" 从本地推送镜像到仓管中心。")])]),e._v(" "),t("h3",{attrs:{id:"本地仓管中心"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#本地仓管中心"}},[e._v("#")]),e._v(" 本地仓管中心")]),e._v(" "),t("p",[e._v("你可以使用 "),t("a",{attrs:{href:"https://github.com/docker/distribution",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker distribution"),t("OutboundLink")],1),e._v(" 项目搭建本地的仓管中心，详情参阅 "),t("a",{attrs:{href:"https://github.com/docker/docker.github.io/blob/master/registry/deploying.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("本地发布 (local deploy)"),t("OutboundLink")],1),e._v(" 的介绍。")]),e._v(" "),t("p",[e._v("科学上网后，也可以看看 "),t("a",{attrs:{href:"https://groups.google.com/a/dockerproject.org/forum/#!forum/distribution",target:"_blank",rel:"noopener noreferrer"}},[e._v("Google+ Group"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("h2",{attrs:{id:"dockerfile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[e._v("#")]),e._v(" Dockerfile")]),e._v(" "),t("p",[e._v("当你执行 "),t("code",[e._v("docker build")]),e._v(" 时，Docker 将会根据 "),t("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/",target:"_blank",rel:"noopener noreferrer"}},[e._v("配置文件"),t("OutboundLink")],1),e._v(" 启动 Docker 容器。远优于使用 "),t("code",[e._v("docker commit")]),e._v("。")]),e._v(" "),t("p",[e._v("以下是一些编写 Dockerfile 的常用编辑器，并链接到适配的语法高亮模块︰")]),e._v(" "),t("ul",[t("li",[e._v("如果你在使用 "),t("a",{attrs:{href:"http://jedit.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("jEdit"),t("OutboundLink")],1),e._v("，你可以使用我开发的 Dockerfile "),t("a",{attrs:{href:"https://github.com/wsargent/jedit-docker-mode",target:"_blank",rel:"noopener noreferrer"}},[e._v("语法高亮模块"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("li",[e._v("[Sublime Text 2](https://packagecontrol.io/packages/Dockerfile Syntax Highlighting)")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://atom.io/packages/language-docker",target:"_blank",rel:"noopener noreferrer"}},[e._v("Atom"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/ekalinin/Dockerfile.vim",target:"_blank",rel:"noopener noreferrer"}},[e._v("Vim"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/spotify/dockerfile-mode",target:"_blank",rel:"noopener noreferrer"}},[e._v("Emacs"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/docker/docker/tree/master/contrib/syntax/textmate",target:"_blank",rel:"noopener noreferrer"}},[e._v("TextMate"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("更多信息请参阅 "),t("a",{attrs:{href:"https://domeide.github.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker 遇上 IDE"),t("OutboundLink")],1)])]),e._v(" "),t("h3",{attrs:{id:"指令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#指令"}},[e._v("#")]),e._v(" 指令")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#dockerignore-file",target:"_blank",rel:"noopener noreferrer"}},[e._v(".dockerignore"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#from",target:"_blank",rel:"noopener noreferrer"}},[e._v("FROM"),t("OutboundLink")],1),e._v(" 为其他指令设置基础镜像 (Base Image)。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#maintainer-deprecated",target:"_blank",rel:"noopener noreferrer"}},[e._v("MAINTAINER (deprecated - use LABEL instead)"),t("OutboundLink")],1),e._v(" 为生成的镜像设置作者字段。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#run",target:"_blank",rel:"noopener noreferrer"}},[e._v("RUN"),t("OutboundLink")],1),e._v(" 在当前镜像的基础上生成一个新层并执行命令。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#cmd",target:"_blank",rel:"noopener noreferrer"}},[e._v("CMD"),t("OutboundLink")],1),e._v(" 设置容器默认执行命令。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#expose",target:"_blank",rel:"noopener noreferrer"}},[e._v("EXPOSE"),t("OutboundLink")],1),e._v(" 告知 Docker 容器在运行时所要监听的网络端口。注意：并没有实际上将端口设置为可访问。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#env",target:"_blank",rel:"noopener noreferrer"}},[e._v("ENV"),t("OutboundLink")],1),e._v(" 设置环境变量。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#add",target:"_blank",rel:"noopener noreferrer"}},[e._v("ADD"),t("OutboundLink")],1),e._v(" 将文件、目录或远程文件复制到容器中。缓存无效。请尽量用 "),t("code",[e._v("COPY")]),e._v(" 代替 "),t("code",[e._v("ADD")]),e._v("。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#copy",target:"_blank",rel:"noopener noreferrer"}},[e._v("COPY"),t("OutboundLink")],1),e._v(" 将文件或文件夹复制到容器中。注意：将使用 ROOT 用户复制文件，故无论 USER / WORKDIR 指令如何配置，你都需要手动修改其所有者（"),t("code",[e._v("chown")]),e._v("），"),t("code",[e._v("ADD")]),e._v(" 也是一样。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#entrypoint",target:"_blank",rel:"noopener noreferrer"}},[e._v("ENTRYPOINT"),t("OutboundLink")],1),e._v(" 将容器设为可执行的。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#volume",target:"_blank",rel:"noopener noreferrer"}},[e._v("VOLUME"),t("OutboundLink")],1),e._v(" 在容器内部创建挂载点 (mount point) 指向外部挂载的卷标或其他容器。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#user",target:"_blank",rel:"noopener noreferrer"}},[e._v("USER"),t("OutboundLink")],1),e._v(" 设置随后执行 RUN / CMD / ENTRYPOINT 命令的用户名。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#workdir",target:"_blank",rel:"noopener noreferrer"}},[e._v("WORKDIR"),t("OutboundLink")],1),e._v(" 设置工作目录 (working directory)。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#arg",target:"_blank",rel:"noopener noreferrer"}},[e._v("ARG"),t("OutboundLink")],1),e._v(" 定义编译时 (build-time) 变量。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#onbuild",target:"_blank",rel:"noopener noreferrer"}},[e._v("ONBUILD"),t("OutboundLink")],1),e._v(" 添加触发指令，当该镜像被作为其他镜像的基础镜像时该指令会被触发。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#stopsignal",target:"_blank",rel:"noopener noreferrer"}},[e._v("STOPSIGNAL"),t("OutboundLink")],1),e._v(" 设置停止容器时，向容器内发送的系统调用信号 (system call signal)。")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/config/labels-custom-metadata/",target:"_blank",rel:"noopener noreferrer"}},[e._v("LABEL"),t("OutboundLink")],1),e._v(" 将键值对元数据 (key/value metadata) 应用到镜像、容器或是守护进程。")])]),e._v(" "),t("h3",{attrs:{id:"教程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#教程"}},[e._v("#")]),e._v(" 教程")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"http://flux7.com/blogs/docker/docker-tutorial-series-part-3-automation-is-the-word-using-dockerfile/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Flux7's Dockerfile Tutorial"),t("OutboundLink")],1)])]),e._v(" "),t("h3",{attrs:{id:"例子"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[e._v("#")]),e._v(" 例子")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#dockerfile-examples",target:"_blank",rel:"noopener noreferrer"}},[e._v("Examples"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Best practices for writing Dockerfiles"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"http://crosbymichael.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Michael Crosby"),t("OutboundLink")],1),e._v(" 还有更多的 "),t("a",{attrs:{href:"http://crosbymichael.com/dockerfile-best-practices.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Dockerfiles best practices"),t("OutboundLink")],1),e._v(" / "),t("a",{attrs:{href:"http://crosbymichael.com/dockerfile-best-practices-take-2.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("take 2"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"http://jonathan.bergknoff.com/journal/building-good-docker-images",target:"_blank",rel:"noopener noreferrer"}},[e._v("Building Good Docker Images"),t("OutboundLink")],1),e._v(" / "),t("a",{attrs:{href:"http://jonathan.bergknoff.com/journal/building-better-docker-images",target:"_blank",rel:"noopener noreferrer"}},[e._v("Building Better Docker Images"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://speakerdeck.com/garethr/managing-container-configuration-with-metadata",target:"_blank",rel:"noopener noreferrer"}},[e._v("Managing Container Configuration with Metadata"),t("OutboundLink")],1)])]),e._v(" "),t("h2",{attrs:{id:"层-layers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#层-layers"}},[e._v("#")]),e._v(" 层(Layers)")]),e._v(" "),t("p",[e._v("Docker 的版本化文件系统是基于层的。就像 "),t("a",{attrs:{href:"https://docs.docker.com/engine/userguide/storagedriver/imagesandcontainers/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Git 的提交或文件变更系统"),t("OutboundLink")],1),e._v(" 一样。")]),e._v(" "),t("h2",{attrs:{id:"链接-links"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#链接-links"}},[e._v("#")]),e._v(" 链接(Links)")]),e._v(" "),t("p",[e._v("链接 (links) "),t("a",{attrs:{href:"https://docs.docker.com/userguide/dockerlinks/",target:"_blank",rel:"noopener noreferrer"}},[e._v("通过 TCP/IP 端口"),t("OutboundLink")],1),e._v(" 实现 Docker 容器之间的通讯。"),t("a",{attrs:{href:"https://blogs.atlassian.com/2013/11/docker-all-the-things-at-atlassian-automation-and-wiring/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Atlassian"),t("OutboundLink")],1),e._v(" 展示了可用的例子。你还可以 "),t("a",{attrs:{href:"https://docs.docker.com/engine/userguide/networking/default_network/dockerlinks/#/updating-the-etchosts-file",target:"_blank",rel:"noopener noreferrer"}},[e._v("通过主机名 (hostname) 链接"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("p",[e._v("在某种意义上来说，该特性已经被 "),t("a",{attrs:{href:"https://docs.docker.com/network/",target:"_blank",rel:"noopener noreferrer"}},[e._v("自定义网络"),t("OutboundLink")],1),e._v(" 所替代。")]),e._v(" "),t("p",[e._v("注意: 如果你希望容器之间"),t("strong",[e._v("只")]),e._v("通过链接进行通讯，在启动 Docker 守护进程时，请使用 "),t("code",[e._v("-icc=false")]),e._v(" 来禁用内部进程通讯。")]),e._v(" "),t("p",[e._v("假设你有一个名为 CONTAINER 的容器（通过 "),t("code",[e._v("docker run --name CONTAINER")]),e._v(" 指定）并且在 Dockerfile 中，暴露了一个端口:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("EXPOSE 1337\n")])])]),t("p",[e._v("然后，我们创建另外一个名为 LINKED 的容器:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker run -d --link CONTAINER:ALIAS --name LINKED user/wordpress\n")])])]),t("p",[e._v("然后 CONTAINER 暴露的端口和别名将会以如下的环境变量出现在 LINKED 中:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("$ALIAS_PORT_1337_TCP_PORT\n$ALIAS_PORT_1337_TCP_ADDR\n")])])]),t("p",[e._v("那么你便可以通过这种方式来连接它了。")]),e._v(" "),t("p",[e._v("使用 "),t("code",[e._v("docker rm --link")]),e._v(" 即可删除链接。")]),e._v(" "),t("p",[e._v("通常，Docker 容器（亦可理解为「服务」）之间的链接，是「服务发现」的一个子集。如果你打算在生产中大规模使用 Docker，这将是一个很大的问题。请参阅"),t("a",{attrs:{href:"https://www.digitalocean.com/community/tutorials/the-docker-ecosystem-service-discovery-and-distributed-configuration-stores",target:"_blank",rel:"noopener noreferrer"}},[e._v("The Docker Ecosystem: Service Discovery and Distributed Configuration Stores"),t("OutboundLink")],1),e._v(" 获取更多信息。")]),e._v(" "),t("h2",{attrs:{id:"卷标-volumes-和挂载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#卷标-volumes-和挂载"}},[e._v("#")]),e._v(" 卷标(Volumes)和挂载")]),e._v(" "),t("h3",{attrs:{id:"卷标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#卷标"}},[e._v("#")]),e._v(" 卷标")]),e._v(" "),t("p",[e._v("Docker 的卷标 (volumes) 是 "),t("a",{attrs:{href:"https://docs.docker.com/engine/tutorials/dockervolumes/",target:"_blank",rel:"noopener noreferrer"}},[e._v("独立的文件系统"),t("OutboundLink")],1),e._v("。它们并非必须连接到特定的容器上。")]),e._v(" "),t("p",[t("code",[e._v("数据卷")]),e._v(" 是一个可供一个或多个容器使用的特殊目录，它绕过 UFS，可以提供很多有用的特性：")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("数据卷")]),e._v(" 可以在容器之间共享和重用")]),e._v(" "),t("li",[e._v("对 "),t("code",[e._v("数据卷")]),e._v(" 的修改会立马生效")]),e._v(" "),t("li",[e._v("对 "),t("code",[e._v("数据卷")]),e._v(" 的更新，不会影响镜像")]),e._v(" "),t("li",[t("code",[e._v("数据卷")]),e._v(" 默认会一直存在，即使容器被删除")])]),e._v(" "),t("p",[e._v("卷标相关命令：")]),e._v(" "),t("ul",[t("li",[t("p",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/volume_create/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker volume create")]),t("OutboundLink")],1),e._v(" - 创建卷标")])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/volume_rm/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker volume rm")]),t("OutboundLink")],1),e._v(" - 删除卷标")])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/volume_ls/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker volume ls")]),t("OutboundLink")],1),e._v(" - 查看卷标")])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/volume_inspect/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker volume inspect")]),t("OutboundLink")],1),e._v(" - 查看数据卷的具体信息")])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/volume_prune/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("docker volume prune")]),t("OutboundLink")],1),e._v(" -  清理无主的数据卷")])])]),e._v(" "),t("p",[e._v("卷标在不能使用链接（只有 TCP/IP）的情况下非常有用。例如，如果你有两个 Docker 实例需要通讯并在文件系统上留下记录。")]),e._v(" "),t("p",[e._v("你可以一次性将其挂载到多个 docker 容器上，通过 "),t("code",[e._v("docker run --volumes-from")]),e._v("。")]),e._v(" "),t("p",[e._v("因为卷标是独立的文件系统，它们通常被用于存储各容器之间的瞬时状态。也就是说，你可以配置一个无状态临时容器，关掉之后，当你有第二个这种临时容器实例的时候，你可以从上一次保存的状态继续执行。")]),e._v(" "),t("p",[e._v("查看 "),t("a",{attrs:{href:"http://crosbymichael.com/advanced-docker-volumes.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("卷标进阶"),t("OutboundLink")],1),e._v(" 来获取更多细节。"),t("a",{attrs:{href:"http://container42.com/2014/11/03/docker-indepth-volumes/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Container42"),t("OutboundLink")],1),e._v(" 非常有用。")]),e._v(" "),t("p",[e._v("你可以 "),t("a",{attrs:{href:"https://docs.docker.com/engine/tutorials/dockervolumes/#mount-a-host-directory-as-a-data-volume",target:"_blank",rel:"noopener noreferrer"}},[e._v("将宿主 MacOS 的文件夹映射为 Docker 卷标"),t("OutboundLink")],1),e._v("：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker run -v /Users/wsargent/myapp/src:/src\n")])])]),t("p",[e._v("你也可以用远程 NFS 卷标，如果你觉得你 "),t("a",{attrs:{href:"https://docs.docker.com/engine/tutorials/dockervolumes/#/mount-a-shared-storage-volume-as-a-data-volume",target:"_blank",rel:"noopener noreferrer"}},[e._v("有足够勇气"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("p",[e._v("还可以考虑运行一个纯数据容器，像 "),t("a",{attrs:{href:"http://container42.com/2013/12/16/persistent-volumes-with-docker-container-as-volume-pattern/",target:"_blank",rel:"noopener noreferrer"}},[e._v("这里"),t("OutboundLink")],1),e._v(" 所说的那样，提供可移植数据。")]),e._v(" "),t("p",[e._v("记得，"),t("a",{attrs:{href:"https://github.com/wsargent/docker-cheat-sheet/tree/master/zh-cn#%E5%B0%86%E6%96%87%E4%BB%B6%E6%8C%82%E8%BD%BD%E4%B8%BA%E5%8D%B7%E6%A0%87",target:"_blank",rel:"noopener noreferrer"}},[e._v("文件也可以被挂载为卷标"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("h3",{attrs:{id:"挂载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#挂载"}},[e._v("#")]),e._v(" 挂载")]),e._v(" "),t("p",[e._v("使用 "),t("code",[e._v("--mount")]),e._v(" 标记可以指定挂载一个本地主机的目录到容器中去。")]),e._v(" "),t("p",[e._v("在用 "),t("code",[e._v("docker run")]),e._v(" 命令的时候，使用 "),t("code",[e._v("--mount")]),e._v(" 标记来将 "),t("code",[e._v("数据卷")]),e._v(" 挂载到容器里。在一次 "),t("code",[e._v("docker run")]),e._v(" 中可以挂载多个 "),t("code",[e._v("数据卷")]),e._v("。")]),e._v(" "),t("h2",{attrs:{id:"最佳实践"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最佳实践"}},[e._v("#")]),e._v(" 最佳实践")]),e._v(" "),t("p",[e._v("这里有一些最佳实践，以及争论焦点：")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"http://gregoryszorc.com/blog/2014/10/16/the-rabbit-hole-of-using-docker-in-automated-tests/",target:"_blank",rel:"noopener noreferrer"}},[e._v("The Rabbit Hole of Using Docker in Automated Tests"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://twitter.com/bridgetkromhout",target:"_blank",rel:"noopener noreferrer"}},[e._v("Bridget Kromhout"),t("OutboundLink")],1),e._v(" has a useful blog post on "),t("a",{attrs:{href:"http://sysadvent.blogspot.co.uk/2014/12/day-1-docker-in-production-reality-not.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("running Docker in production"),t("OutboundLink")],1),e._v(" at Dramafever.")]),e._v(" "),t("li",[e._v("There's also a best practices "),t("a",{attrs:{href:"http://developers.lyst.com/devops/2014/12/08/docker/",target:"_blank",rel:"noopener noreferrer"}},[e._v("blog post"),t("OutboundLink")],1),e._v(" from Lyst.")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://engineering.salesforceiq.com/2013/11/05/a-docker-dev-environment-in-24-hours-part-2-of-2.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("A Docker Dev Environment in 24 Hours!"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://tersesystems.com/2013/11/20/building-a-development-environment-with-docker/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Building a Development Environment With Docker"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://samsaffron.com/archive/2013/11/07/discourse-in-a-docker-container",target:"_blank",rel:"noopener noreferrer"}},[e._v("Discourse in a Docker Container"),t("OutboundLink")],1)])]),e._v(" "),t("h2",{attrs:{id:"安全-security"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安全-security"}},[e._v("#")]),e._v(" 安全(Security)")]),e._v(" "),t("p",[e._v("这节准备讨论一些关于 Docker 安全性的问题。Docker 官方文档 "),t("a",{attrs:{href:"https://docs.docker.com/articles/security/",target:"_blank",rel:"noopener noreferrer"}},[e._v("安全"),t("OutboundLink")],1),e._v(" 页面讲述了更多细节。")]),e._v(" "),t("p",[e._v("首先第一件事：Docker 是有 root 权限的。如果你在 "),t("code",[e._v("docker")]),e._v(" 组，那么你就有 "),t("a",{attrs:{href:"https://web.archive.org/web/20161226211755/http://reventlov.com/advisories/using-the-docker-command-to-root-the-host",target:"_blank",rel:"noopener noreferrer"}},[e._v("root 权限"),t("OutboundLink")],1),e._v("。如果你将 Docker 的 Unix Socket 暴露给容器，意味着你赋予了容器 "),t("a",{attrs:{href:"https://www.lvh.io/posts/dont-expose-the-docker-socket-not-even-to-a-container.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("宿主机 root 权限"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("p",[e._v("Docker 不应当作为唯一的防御措施。你应当使其更加安全可靠。")]),e._v(" "),t("p",[e._v("为了更好地理解容器暴露了什么，可参阅由 "),t("a",{attrs:{href:"https://twitter.com/dyn___",target:"_blank",rel:"noopener noreferrer"}},[e._v("Aaron Grattafiori"),t("OutboundLink")],1),e._v(" 编写的 "),t("a",{attrs:{href:"https://www.nccgroup.trust/globalassets/our-research/us/whitepapers/2016/april/ncc_group_understanding_hardening_linux_containers-1-1.pdf",target:"_blank",rel:"noopener noreferrer"}},[e._v("Understanding and Hardening Linux Containers"),t("OutboundLink")],1),e._v("。这是一个完整全面且包含大量链接和脚注的容器问题指南，介绍了许多有用的内容。即使你已经加固过容器，以下的安全提示依然十分有帮助，但并不能代替理解的过程。")]),e._v(" "),t("h3",{attrs:{id:"安全提示"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安全提示"}},[e._v("#")]),e._v(" 安全提示")]),e._v(" "),t("p",[e._v("为了最大的安全性，你应当考虑在虚拟机上运行 Docker。这是直接从 Docker 安全团队拿来的资料 -- "),t("a",{attrs:{href:"http://www.slideshare.net/jpetazzo/linux-containers-lxc-docker-and-security",target:"_blank",rel:"noopener noreferrer"}},[e._v("slides"),t("OutboundLink")],1),e._v(" / "),t("a",{attrs:{href:"http://www.projectatomic.io/blog/2014/08/is-it-safe-a-look-at-docker-and-security-from-linuxcon/",target:"_blank",rel:"noopener noreferrer"}},[e._v("notes"),t("OutboundLink")],1),e._v("。之后，可使用 AppArmor、seccomp、SELinux、grsec 等来 "),t("a",{attrs:{href:"http://linux-audit.com/docker-security-best-practices-for-your-vessel-and-containers/",target:"_blank",rel:"noopener noreferrer"}},[e._v("限制容器的权限"),t("OutboundLink")],1),e._v("。更多细节，请查阅 "),t("a",{attrs:{href:"https://blog.docker.com/2016/02/docker-engine-1-10-security/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker 1.10 security features"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("p",[e._v("Docker 镜像 ID 属于 "),t("a",{attrs:{href:"https://medium.com/@quayio/your-docker-image-ids-are-secrets-and-its-time-you-treated-them-that-way-f55e9f14c1a4",target:"_blank",rel:"noopener noreferrer"}},[e._v("敏感信息"),t("OutboundLink")],1),e._v(" 所以它不应该向外界公开。请将它们当作密码来对待。")]),e._v(" "),t("p",[e._v("阅读由 "),t("a",{attrs:{href:"https://github.com/konstruktoid",target:"_blank",rel:"noopener noreferrer"}},[e._v("Thomas Sjögren"),t("OutboundLink")],1),e._v(" 编写的 "),t("a",{attrs:{href:"https://github.com/konstruktoid/Docker/blob/master/Security/CheatSheet.adoc",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Security Cheat Sheet"),t("OutboundLink")],1),e._v("：关于加固容器的不错的建议。")]),e._v(" "),t("p",[e._v("查看 "),t("a",{attrs:{href:"https://github.com/docker/docker-bench-security",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker 安全测试脚本"),t("OutboundLink")],1),e._v("，下载 "),t("a",{attrs:{href:"https://blog.docker.com/2015/05/understanding-docker-security-and-best-practices/",target:"_blank",rel:"noopener noreferrer"}},[e._v("最佳实践白皮书"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("p",[e._v("你应当远离使用非稳定版本 grsecurity / pax 的内核，比如 "),t("a",{attrs:{href:"https://en.wikipedia.org/wiki/Alpine_Linux",target:"_blank",rel:"noopener noreferrer"}},[e._v("Alpine Linux"),t("OutboundLink")],1),e._v("。如果在产品中用了 grsecurity，那么你应该考虑使用有 "),t("a",{attrs:{href:"https://grsecurity.net/business_support.php",target:"_blank",rel:"noopener noreferrer"}},[e._v("商业支持"),t("OutboundLink")],1),e._v(" 的 "),t("a",{attrs:{href:"https://grsecurity.net/announce.php",target:"_blank",rel:"noopener noreferrer"}},[e._v("稳定版本"),t("OutboundLink")],1),e._v("，就像你对待 RedHat 那样。虽然要 $200 每月，但对于你的运维预算来说不值一提。")]),e._v(" "),t("p",[e._v("从 Docker 1.11 开始，你可以轻松的限制在容器中可用的进程数，以防止 fork 炸弹。 这要求 Linux 内核 >= 4.3，并且要在内核配置中打开 CGROUP_PIDS=y。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker run --pids-limit=64\n")])])]),t("p",[e._v("同时，你也可以限制进程再获取新权限。该功能是 Linux 内核从 3.5 版本开始就拥有的。你可以从 "),t("a",{attrs:{href:"http://www.projectatomic.io/blog/2016/03/no-new-privs-docker/",target:"_blank",rel:"noopener noreferrer"}},[e._v("这篇博客"),t("OutboundLink")],1),e._v(" 中阅读到更多关于这方面的内容。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker run --security-opt=no-new-privileges\n")])])]),t("p",[e._v("以下内容摘选自 "),t("a",{attrs:{href:"http://container-solutions.com/is-docker-safe-for-production/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Container Solutions"),t("OutboundLink")],1),e._v(" 的 "),t("a",{attrs:{href:"http://container-solutions.com/content/uploads/2015/06/15.06.15_DockerCheatSheet_A2.pdf",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Security Cheat Sheet"),t("OutboundLink")],1),e._v("（PDF 版本，难以使用，故复制至此）：")]),e._v(" "),t("p",[e._v("关闭内部进程通讯：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker -d --icc=false --iptables\n")])])]),t("p",[e._v("设置容器为只读：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker run --read-only\n")])])]),t("p",[e._v("通过 hashsum 来验证卷标：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker pull debian@sha256:a25306f3850e1bd44541976aa7b5fd0a29be\n")])])]),t("p",[e._v("设置卷标为只读：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker run -v $(pwd)/secrets:/secrets:ro debian\n")])])]),t("p",[e._v("在 Dockerfile 中定义用户并以该用户运行，避免在容器中以 ROOT 身份操作：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("RUN groupadd -r user && useradd -r -g user user\nUSER user\n")])])]),t("h3",{attrs:{id:"用户命名空间-user-namespaces"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用户命名空间-user-namespaces"}},[e._v("#")]),e._v(" 用户命名空间(User Namespaces)")]),e._v(" "),t("p",[e._v("还可以通过使用 "),t("a",{attrs:{href:"https://s3hh.wordpress.com/2013/07/19/creating-and-using-containers-without-privilege/",target:"_blank",rel:"noopener noreferrer"}},[e._v("用户命名空间"),t("OutboundLink")],1),e._v(" -- 自 1.10 版本起已内置，但默认并未启用。")]),e._v(" "),t("p",[e._v("要在 Ubuntu 15.10 中启用用户命名空间 (remap the userns)，请 "),t("a",{attrs:{href:"https://raesene.github.io/blog/2016/02/04/Docker-User-Namespaces/",target:"_blank",rel:"noopener noreferrer"}},[e._v("跟着这篇博客的例子"),t("OutboundLink")],1),e._v(" 来做。")]),e._v(" "),t("h3",{attrs:{id:"安全相关视频"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安全相关视频"}},[e._v("#")]),e._v(" 安全相关视频")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://youtu.be/04LOuMgNj9U",target:"_blank",rel:"noopener noreferrer"}},[e._v("Using Docker Safely"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://youtu.be/KmxOXmPhZbk",target:"_blank",rel:"noopener noreferrer"}},[e._v("Securing your applications using Docker"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://youtu.be/a9lE9Urr6AQ",target:"_blank",rel:"noopener noreferrer"}},[e._v("Container security: Do containers actually contain?"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.youtube.com/watch?v=iN6QbszB1R8",target:"_blank",rel:"noopener noreferrer"}},[e._v("Linux Containers: Future or Fantasy?"),t("OutboundLink")],1)])]),e._v(" "),t("h3",{attrs:{id:"安全路线图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安全路线图"}},[e._v("#")]),e._v(" 安全路线图")]),e._v(" "),t("p",[e._v("Docker 的路线图提到关于 "),t("a",{attrs:{href:"https://github.com/docker/docker/blob/master/ROADMAP.md#11-security",target:"_blank",rel:"noopener noreferrer"}},[e._v("seccomp 的支持"),t("OutboundLink")],1),e._v("。 一个名为 "),t("a",{attrs:{href:"https://github.com/jfrazelle/bane",target:"_blank",rel:"noopener noreferrer"}},[e._v("bane"),t("OutboundLink")],1),e._v(" 的 AppArmor 策略生成器正在实现 "),t("a",{attrs:{href:"https://github.com/docker/docker/issues/17142",target:"_blank",rel:"noopener noreferrer"}},[e._v("安全配置文件"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("h2",{attrs:{id:"小贴士"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#小贴士"}},[e._v("#")]),e._v(" 小贴士")]),e._v(" "),t("p",[e._v("链接：")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"http://sssslide.com/speakerdeck.com/bmorearty/15-docker-tips-in-5-minutes",target:"_blank",rel:"noopener noreferrer"}},[e._v("15 Docker Tips in 5 minutes"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://codefresh.io/blog/everyday-hacks-docker/",target:"_blank",rel:"noopener noreferrer"}},[e._v("CodeFresh Everyday Hacks Docker"),t("OutboundLink")],1)])]),e._v(" "),t("h3",{attrs:{id:"清理-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#清理-2"}},[e._v("#")]),e._v(" 清理")]),e._v(" "),t("p",[e._v("最新的 "),t("a",{attrs:{href:"https://github.com/docker/docker/pull/26108",target:"_blank",rel:"noopener noreferrer"}},[e._v("数据管理命令"),t("OutboundLink")],1),e._v(" 已在 Docker 1.13 实现：")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("docker system prune")])]),e._v(" "),t("li",[t("code",[e._v("docker volume prune")])]),e._v(" "),t("li",[t("code",[e._v("docker network prune")])]),e._v(" "),t("li",[t("code",[e._v("docker container prune")])]),e._v(" "),t("li",[t("code",[e._v("docker image prune")])])]),e._v(" "),t("h3",{attrs:{id:"df-命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#df-命令"}},[e._v("#")]),e._v(" df 命令")]),e._v(" "),t("p",[t("code",[e._v("docker system df")]),e._v(" 将显示当前 Docker 各部分占用的磁盘空间。")]),e._v(" "),t("h3",{attrs:{id:"heredoc-声明-docker-容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#heredoc-声明-docker-容器"}},[e._v("#")]),e._v(" Heredoc 声明 Docker 容器")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker build -t htop - << EOF\nFROM alpine\nRUN apk --no-cache add htop\nEOF\n")])])]),t("h3",{attrs:{id:"最近一次的容器-id"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最近一次的容器-id"}},[e._v("#")]),e._v(" 最近一次的容器 ID")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("alias dl='docker ps -l -q'\ndocker run ubuntu echo hello world\ndocker commit $(dl) helloworld\n")])])]),t("h3",{attrs:{id:"带命令的提交-需要-dockerfile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#带命令的提交-需要-dockerfile"}},[e._v("#")]),e._v(" 带命令的提交（需要 Dockerfile）")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('docker commit -run=\'{"Cmd":["postgres", "-too -many -opts"]}\' $(dl) postgres\n')])])]),t("h3",{attrs:{id:"获取-ip-地址"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取-ip-地址"}},[e._v("#")]),e._v(" 获取 IP 地址")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker inspect $(dl) | grep -wm1 IPAddress | cut -d '\"' -f 4\n")])])]),t("p",[e._v("或使用 "),t("a",{attrs:{href:"https://stedolan.github.io/jq/",target:"_blank",rel:"noopener noreferrer"}},[e._v("jq"),t("OutboundLink")],1),e._v(":")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker inspect $(dl) | jq -r '.[0].NetworkSettings.IPAddress'\n")])])]),t("p",[e._v("或使用 "),t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/inspect",target:"_blank",rel:"noopener noreferrer"}},[e._v("go 模板"),t("OutboundLink")],1),e._v("：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker inspect -f '{{ .NetworkSettings.IPAddress }}' <container_name>\n")])])]),t("p",[e._v("或在通过 Dockerfile 构建镜像时，通过构建参数 (build argument) 传入：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("DOCKER_HOST_IP=`ifconfig | grep -E \"([0-9]{1,3}\\.){3}[0-9]{1,3}\" | grep -v 127.0.0.1 | awk '{ print $2 }' | cut -f2 -d: | head -n1`\necho DOCKER_HOST_IP = $DOCKER_HOST_IP\ndocker build \\\n  --build-arg ARTIFACTORY_ADDRESS=$DOCKER_HOST_IP\n  -t sometag \\\n  some-directory/\n")])])]),t("h3",{attrs:{id:"获取端口映射"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取端口映射"}},[e._v("#")]),e._v(" 获取端口映射")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker inspect -f '{{range $p, $conf := .NetworkSettings.Ports}} {{$p}} -> {{(index $conf 0).HostPort}} {{end}}' <containername>\n")])])]),t("h3",{attrs:{id:"通过正则匹配容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通过正则匹配容器"}},[e._v("#")]),e._v(" 通过正则匹配容器")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('for i in $(docker ps -a | grep "REGEXP_PATTERN" | cut -f1 -d" "); do echo $i; done`\n')])])]),t("h3",{attrs:{id:"获取环境变量配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取环境变量配置"}},[e._v("#")]),e._v(" 获取环境变量配置")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker run --rm ubuntu env\n")])])]),t("h3",{attrs:{id:"强行终止运行中的容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#强行终止运行中的容器"}},[e._v("#")]),e._v(" 强行终止运行中的容器")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker kill $(docker ps -q)\n")])])]),t("h3",{attrs:{id:"删除所有容器-强行删除-无论容器运行或停止"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除所有容器-强行删除-无论容器运行或停止"}},[e._v("#")]),e._v(" 删除所有容器（强行删除！无论容器运行或停止）")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker rm -f $(docker ps -qa)\n")])])]),t("h3",{attrs:{id:"删除旧容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除旧容器"}},[e._v("#")]),e._v(" 删除旧容器")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker ps -a | grep 'weeks ago' | awk '{print $1}' | xargs docker rm\n")])])]),t("h3",{attrs:{id:"删除已停止的容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除已停止的容器"}},[e._v("#")]),e._v(" 删除已停止的容器")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker rm -v `docker ps -a -q -f status=exited`\n")])])]),t("h3",{attrs:{id:"停止并删除容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#停止并删除容器"}},[e._v("#")]),e._v(" 停止并删除容器")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker stop $(docker ps -aq) && docker rm -v $(docker ps -aq)\n")])])]),t("h3",{attrs:{id:"删除无用-dangling-的镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除无用-dangling-的镜像"}},[e._v("#")]),e._v(" 删除无用 (dangling) 的镜像")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker rmi $(docker images -q -f dangling=true)\n")])])]),t("h3",{attrs:{id:"删除所有镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除所有镜像"}},[e._v("#")]),e._v(" 删除所有镜像")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker rmi $(docker images -q)\n")])])]),t("h3",{attrs:{id:"删除无用-dangling-的卷标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除无用-dangling-的卷标"}},[e._v("#")]),e._v(" 删除无用 (dangling) 的卷标")]),e._v(" "),t("p",[e._v("Docker 1.9 版本起：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker volume rm $(docker volume ls -q -f dangling=true)\n")])])]),t("p",[e._v("1.9.0 中，参数 "),t("code",[e._v("dangling=false")]),e._v(" 居然 "),t("em",[e._v("没")]),e._v(" 用 - 它会被忽略然后列出所有的卷标。")]),e._v(" "),t("h3",{attrs:{id:"查看镜像依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看镜像依赖"}},[e._v("#")]),e._v(" 查看镜像依赖")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker images -viz | dot -Tpng -o docker.png\n")])])]),t("h3",{attrs:{id:"docker-容器瘦身"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-容器瘦身"}},[e._v("#")]),e._v(" Docker 容器瘦身")]),e._v(" "),t("ul",[t("li",[e._v("在某层 (RUN layer) 清理 APT")])]),e._v(" "),t("p",[e._v("这应当和其他 apt 命令在同一层中完成。 否则，前面的层将会保持原有信息，而你的镜像则依旧臃肿。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("RUN {apt commands} \\\n  && apt-get clean \\\n  && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n")])])]),t("ul",[t("li",[e._v("压缩镜像")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("ID=$(docker run -d image-name /bin/bash)\ndocker export $ID | docker import – flat-image-name\n")])])]),t("ul",[t("li",[e._v("备份")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("ID=$(docker run -d image-name /bin/bash)\n(docker export $ID | gzip -c > image.tgz)\ngzip -dc image.tgz | docker import - flat-image-name\n")])])]),t("h3",{attrs:{id:"监视运行中容器的系统资源利用率"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监视运行中容器的系统资源利用率"}},[e._v("#")]),e._v(" 监视运行中容器的系统资源利用率")]),e._v(" "),t("p",[e._v("检查某个容器的 CPU、内存以及网络 I/O 使用情况，你可以：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker stats <container>\n")])])]),t("p",[e._v("按 ID 列出所有容器：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker stats $(docker ps -q)\n")])])]),t("p",[e._v("按名称列出所有容器：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker stats $(docker ps --format '{{.Names}}')\n")])])]),t("p",[e._v("按指定镜像名称列出所有容器：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker ps -a -f ancestor=ubuntu\n")])])]),t("p",[e._v("删除所有未标签命名 (untagged) 的容器：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker rmi $(docker images | grep “^” | awk '{split($0,a,\" \"); print a[3]}')\n")])])]),t("p",[e._v("通过正则匹配删除指定容器：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker ps -a | grep wildfly | awk '{print $1}' | xargs docker rm -f\n")])])]),t("p",[e._v("删除所有已退出 (exited) 的容器：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker rm -f $(docker ps -a | grep Exit | awk '{ print $1 }')\n")])])]),t("h3",{attrs:{id:"将文件挂载为卷标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#将文件挂载为卷标"}},[e._v("#")]),e._v(" 将文件挂载为卷标")]),e._v(" "),t("p",[e._v("文件也可以被挂载为卷标。例如你可以仅仅注入单个配置文件：")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 从容器复制文件")]),e._v("\ndocker run --rm httpd "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" /usr/local/apache2/conf/httpd.conf "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" httpd.conf\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 编辑文件")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("vim")]),e._v(" httpd.conf\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 挂载修改后的配置启动容器")]),e._v("\ndocker run --rm -ti -v "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),t("span",{pre:!0,attrs:{class:"token environment constant"}},[e._v("$PWD")]),e._v('/httpd.conf:/usr/local/apache2/conf/httpd.conf:ro"')]),e._v(" -p "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"80:80"')]),e._v(" httpd\n")])])]),t("h2",{attrs:{id:"参考资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[e._v("#")]),e._v(" 参考资料")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/wsargent/docker-cheat-sheet/tree/master/zh-cn",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Cheat Sheet"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);r.default=n.exports}}]);